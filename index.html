<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®šåˆ¶ä½ çš„ AI åœ£è¯æ ‘</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        h1 {
            margin-bottom: 1.5rem;
            font-weight: 300;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #ddd;
        }

        input[type="text"], 
        input[type="file"] {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            box-sizing: border-box;
            outline: none;
            transition: background 0.3s;
        }

        input[type="text"]:focus {
            background: rgba(255, 255, 255, 0.3);
        }

        /* æ–‡ä»¶ä¸Šä¼ æŒ‰é’®ç¾åŒ– */
        input[type="file"]::file-selector-button {
            margin-right: 10px;
            border: none;
            background: #d42f2f;
            padding: 5px 10px;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            transition: background .2s ease-in-out;
        }

        input[type="file"]::file-selector-button:hover {
            background: #b92b2b;
        }

        button.submit-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #d42f2f, #ff6b6b);
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 1rem;
        }

        button.submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 47, 47, 0.4);
        }

        button.submit-btn:active {
            transform: translateY(0);
        }

        .preview-img {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 8px;
            display: none;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .note {
            font-size: 0.8rem;
            color: #aaa;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ„ å®šåˆ¶åœ£è¯æ ‘</h1>
        
        <div class="form-group">
            <label for="greeting">å†™ä¸€å¥ç¥ç¦è¯­ (å»ºè®®10å­—ä»¥å†…):</label>
            <input type="text" id="greeting" placeholder="Merry Christmas" maxlength="20">
        </div>

        <div class="form-group">
            <label for="photo">ä¸Šä¼ ä¸€å¼ ç…§ç‰‡ (å¯é€‰):</label>
            <input type="file" id="photo" accept="image/*">
            <p class="note">æ³¨æ„ï¼šiPadè¯·å°½é‡ä½¿ç”¨æˆªå›¾æˆ–å°å›¾ï¼Œé¿å…å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚</p>
            <img id="preview" class="preview-img" alt="é¢„è§ˆ">
        </div>

        <button class="submit-btn" onclick="saveAndGo()">ç”Ÿæˆå¹¶æŸ¥çœ‹</button>
    </div>

    <script>
        // å›¾ç‰‡é¢„è§ˆé€»è¾‘
        document.getElementById('photo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('preview');
                    img.src = e.target.result;
                    img.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });

        function saveAndGo() {
            const greeting = document.getElementById('greeting').value || "Merry Christmas";
            const photoInput = document.getElementById('photo');
            
            try {
                localStorage.setItem('xmas_greeting', greeting);

                if (photoInput.files && photoInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            // ç®€å•çš„å›¾ç‰‡å‹ç¼©é€»è¾‘ï¼ˆå¦‚æœå›¾ç‰‡å¤ªå¤§ï¼ŒlocalStorageå­˜ä¸ä¸‹ï¼‰
                            const img = new Image();
                            img.src = e.target.result;
                            img.onload = function() {
                                const canvas = document.createElement('canvas');
                                const ctx = canvas.getContext('2d');
                                // é™åˆ¶æœ€å¤§å®½åº¦ä¸º 500px
                                const maxWidth = 500;
                                const scale = maxWidth / img.width;
                                const width = maxWidth;
                                const height = img.height * scale;
                                
                                canvas.width = width;
                                canvas.height = height;
                                ctx.drawImage(img, 0, 0, width, height);
                                
                                // å‹ç¼©è´¨é‡ 0.7
                                const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.7);
                                localStorage.setItem('xmas_photo', compressedDataUrl);
                                window.location.href = 'tree.html';
                            }
                        } catch (err) {
                            console.error(err);
                            alert("å›¾ç‰‡å¤„ç†å‡ºé”™ï¼Œè¯·æ¢ä¸€å¼ è¯•è¯•ã€‚");
                            window.location.href = 'tree.html';
                        }
                    };
                    reader.readAsDataURL(photoInput.files[0]);
                } else {
                    localStorage.removeItem('xmas_photo');
                    window.location.href = 'tree.html';
                }
            } catch (e) {
                alert("å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚è¯·ä¸è¦ä¸Šä¼ å›¾ç‰‡ï¼Œæˆ–è€…æ¢ä¸€å¼ éå¸¸å°çš„å›¾ç‰‡ã€‚");
                // å³ä½¿å‡ºé”™ä¹Ÿå°è¯•è·³è½¬
                window.location.href = 'tree.html';
            }
        }
    </script>
</body>
</html>
